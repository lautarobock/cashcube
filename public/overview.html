<!DOCTYPE html>
<html>
<head>
    <title>CubeCash - Overview</title>
    <link href="bower_components/bootstrap-css-only/css/bootstrap.min.css" rel="stylesheet">
    <script src="bower_components/angular/angular.min.js"></script>
    <script src="bower_components/angular-bootstrap/ui-bootstrap-tpls.min.js"></script>
    <script src="js/overview.js"></script>
    <script src="js/util.js"></script>
</head>
<body ng-app="overview">
	<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="" style="margin-left: 5em">
        <a class="navbar-brand" href="/movement.html">
          CubeCash
        </a>
        <div class="collapse navbar-collapse navbar-ex1-collapse" >
            <ul class="nav navbar-nav">
                <li><a href="movement.html">Movimientos</a></li>
                <li><a href="account.html">Cuentas</a></li>
                <li><a href="currency.html">Moneda</a></li>
                <li><a href="category.html">Categorias</a></li>
                <li><a href="resume.html">Resume</a></li>
                <li><a href="graph.html">Graficos</a></li>
                <li><a href="cube.html">Cubo</a></li>
                <li><a href="addBonus.html">Add Bonus</a></li>
                <li class="active"><a href="overview.html">Overview</a></li>
            </ul>           
        </div>
      </div>
    </nav>
    <div class="container" style="margin: 5em;" ng-controller="OverviewController as overview">
        <div>
            <select class="form-control" ng-model="selected" ng-options="month.value for month in months"></select>
        </div>
        <h2>Gastos del Mes</h2>
        <br/>
        <div ng-if="value.total != 0" ng-repeat="(account, value) in items" class="panel panel-default">
            <div class="panel-heading">
                {{getAccount(account).name}}
                <a href="" ng-show="hasAccountDetail(value)" ng-click="showLabels[account]=!showLabels[account]">
                    <span ng-if="!showLabels[account]"  class="glyphicon glyphicon-expand"></span>
                    <span ng-if="showLabels[account]"  class="glyphicon glyphicon-collapse-up"></span>
                </a>
                <span class="pull-right">{{value.sign}} {{value.total|number:2}}</span>
            </div>
            <div class="panel-body" ng-show="showLabels[account]">
                <table class="table">
                    <tbody>
                        <tr ng-repeat="(label, labelValue) in value.labels" >
                            <td>
                                <span>
                                    {{normalize(label)}}
                                    <a ng-if="labelValue.labels && !showDetails[label]" href="" ng-click="showDetails[label]=!showDetails[label]">
                                        <span class="glyphicon glyphicon-expand"></span>
                                    </a>
                                    <a ng-if="labelValue.labels && showDetails[label]" href="" ng-click="showDetails[label]=!showDetails[label]">
                                        <span class="glyphicon glyphicon-collapse-up"></span>
                                    </a>
                                </span>
                                <div collapse="!showDetails[label]">
                                    <table class="table">
                                        <tbody>
                                            <tr ng-repeat="(subLabel, subLabelValue) in labelValue.labels" >
                                                <td>{{normalize(subLabel)}}</td>
                                                <td>
                                                    <span class="pull-right">{{value.sign}} {{subLabelValue.total|number:2}}</span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </td>
                            <td>
                                <span class="pull-right">{{value.sign}} {{labelValue.total|number:2}}</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <h2>Balance</h2>
        <table class="table">
            <thead>
                <tr>
                    <th>Cuenta</th>
                    <th class="text-right">Cambio</th>
                    <th class="text-right">Saldo</th>
                    <th class="text-right">Inicio Mes</th>
                    <th class="text-right">Diferencia</th>
                    <th class="text-right">Saldo €</th>
                    <th class="text-right">Inicio Mes €</th>
                    <th class="text-right">Diferencia €</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="account in balance" >
                    <td>{{getAccount(account.account_id).name}} ({{getCurrency(account.account_id).sign}})</td>
                    <th class="text-right">{{getCurrency(account.account_id).value}}</td>
                    <td class="text-right" ng-style="styleCurrency(account.actual.credit-account.actual.debit)">
                        {{getCurrency(account.account_id).value*(account.actual.credit-account.actual.debit) | currency:getCurrency(account.account_id).sign+' '}}
                    </td>
                    <td class="text-right" ng-style="styleCurrency(account.prev.credit-account.prev.debit)">
                        {{getCurrency(account.account_id).value*(account.prev.credit-account.prev.debit) | currency:getCurrency(account.account_id).sign+' '}}
                    </td>
                    <td class="text-right" ng-style="styleCurrency(account.actual.credit-account.actual.debit-(account.prev.credit-account.prev.debit))">
                        {{getCurrency(account.account_id).value*(account.actual.credit-account.actual.debit-(account.prev.credit-account.prev.debit)) | currency:getCurrency(account.account_id).sign+' '}}
                    </td>
                    <td class="text-right" ng-style="styleCurrency(account.actual.credit-account.actual.debit)">
                        {{account.actual.credit-account.actual.debit | currency: '€ '}}
                    </td>
                    <td class="text-right" ng-style="styleCurrency(account.prev.credit-account.prev.debit)">
                        {{account.prev.credit-account.prev.debit | currency: '€ '}}
                    </td>
                    <td class="text-right" ng-style="styleCurrency(account.actual.credit-account.actual.debit-(account.prev.credit-account.prev.debit))">
                        {{account.actual.credit-account.actual.debit-(account.prev.credit-account.prev.debit) | currency: '€ '}}
                    </td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <th colspan="5">Total</th>
                    <th class="text-right" ng-style="styleCurrency(totals.balance)">{{totals.balance | currency: '€ '}}</th>
                    <th class="text-right" ng-style="styleCurrency(totals.prev)">{{totals.prev | currency: '€ '}}</th>
                    <th class="text-right" ng-style="styleCurrency(totals.diff)">{{totals.diff | currency: '€ '}}</th>
                </tr>
            </tfoot>
        </table>
    </div>

</body>
</html>
